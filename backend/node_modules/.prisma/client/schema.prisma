generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELED
  NO_SHOW
}

enum PreferredContactMethod {
  PHONE
  EMAIL
  NONE
}

enum AppointmentSource {
  APP
  PHONE
  MANUAL
}

enum TransactionType {
  INCOME
  EXPENSE
}

model Client {
  id                     String                 @id @default(uuid())
  fullName               String
  phone                  String?
  email                  String?
  notes                  String?
  preferredContactMethod PreferredContactMethod @default(NONE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  appointments Appointment[]
  wigPurchases WigPurchase[]
  transactions Transaction[]
}

model WigPurchase {
  id                   String    @id @default(uuid())
  clientId             String
  purchaseDate         DateTime
  wigDescription       String
  price                Int
  warrantyEndDate      DateTime
  freeStylingEndDate   DateTime?
  maxFreeStylingVisits Int?
  notes                String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  client        Client         @relation(fields: [clientId], references: [id], onDelete: Cascade)
  appointments  Appointment[]
  serviceVisits ServiceVisit[]
  transactions  Transaction[]

  @@index([clientId, purchaseDate])
  @@index([warrantyEndDate])
}

model Appointment {
  id            String            @id @default(uuid())
  clientId      String
  startTime     DateTime
  endTime       DateTime
  status        AppointmentStatus @default(SCHEDULED)
  source        AppointmentSource
  serviceName   String
  wigPurchaseId String?
  notes         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  client        Client         @relation(fields: [clientId], references: [id], onDelete: Cascade)
  wigPurchase   WigPurchase?   @relation(fields: [wigPurchaseId], references: [id])
  serviceVisits ServiceVisit[]

  @@index([startTime])
  @@index([clientId, startTime])
}

model ServiceVisit {
  id            String   @id @default(uuid())
  appointmentId String
  wigPurchaseId String?
  visitDate     DateTime
  serviceName   String
  isFree        Boolean  @default(false)
  freeReason    String?
  priceCharged  Int
  internalCost  Int
  notes         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  appointment  Appointment   @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  wigPurchase  WigPurchase?  @relation(fields: [wigPurchaseId], references: [id])
  transactions Transaction[]

  @@index([appointmentId, visitDate])
}

model Transaction {
  id              String          @id @default(uuid())
  type            TransactionType
  amount          Int
  transactionDate DateTime
  clientId        String?
  serviceVisitId  String?
  wigPurchaseId   String?
  category        String
  description     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  client       Client?       @relation(fields: [clientId], references: [id])
  serviceVisit ServiceVisit? @relation(fields: [serviceVisitId], references: [id])
  wigPurchase  WigPurchase?  @relation(fields: [wigPurchaseId], references: [id])

  @@index([transactionDate])
}
